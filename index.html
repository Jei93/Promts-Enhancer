<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Prompt Enhancer — Local</title>
  <meta name="description" content="Prompt Enhancer local — mejora prompts en el navegador.">
  <style>
    :root{--bg:#0f1113;--panel:#121316;--muted:#9aa0a6;--btn:#2f3338;--accent:#5ea3ff}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial,sans-serif;background:var(--bg);color:#e6eef6}
    .wrap{max-width:920px;margin:32px auto;padding:28px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
    h1{margin:0 0 14px;font-size:22px}
    p.lead{margin:0 0 18px;color:var(--muted)}
    textarea{width:100%;min-height:120px;background:var(--panel);border:1px solid rgba(255,255,255,0.04);color:#e6eef6;padding:12px;border-radius:8px;resize:vertical;font-size:15px}
    .controls{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    button{background:var(--btn);border:1px solid rgba(255,255,255,0.03);color:#e6eef6;padding:10px 12px;border-radius:8px;cursor:pointer}
    button.primary{background:linear-gradient(90deg,var(--accent),#2e8eff);border:none;color:#071224}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:18px;margin-top:18px}
    label.small{display:block;color:var(--muted);font-size:13px;margin-bottom:6px}
    ul#history{padding-left:0;margin-top:12px}
    ul#history li{list-style:none;background:rgba(255,255,255,0.02);padding:10px;border-radius:8px;margin-bottom:8px;color:var(--muted);font-size:14px;cursor:default;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
    footer{margin-top:20px;color:var(--muted);font-size:13px;display:flex;justify-content:space-between;align-items:center}
    a.link{color:var(--accent);text-decoration:none}
    /* cookie banner */
    #cookieBanner{position:fixed;left:18px;right:18px;bottom:18px;background:#0c1114;border:1px solid rgba(255,255,255,0.04);padding:12px;border-radius:10px;display:flex;gap:12px;align-items:center;box-shadow:0 8px 30px rgba(0,0,0,0.6)}
    #cookieBanner p{margin:0;color:var(--muted);font-size:14px}
    #cookieBanner .cb-actions{margin-left:auto;display:flex;gap:8px}
    @media(max-width:760px){.row{grid-template-columns:1fr;}.wrap{margin:12px;padding:16px}}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Prompt Enhancer — versión local</h1>
    <p class="lead">Mejora prompts directamente en el navegador. Cero servidor, cero APIs. Copia y pega. Puedes añadir Google Analytics reemplazando el ID en la configuración inferior.</p>

    <label class="small">Prompt original</label>
    <textarea id="inputPrompt" placeholder="Escribe aquí tu prompt... Ej: 'Dame una sinopsis corta sobre una civilización submarina que perdió su memoria.'"></textarea>

    <div class="controls">
      <button class="primary" id="btnEnhance">Mejorar</button>
      <button id="btnEnhance3">Mejorar x3</button>
      <button id="btnClear">Limpiar</button>
      <button id="btnExport">Descargar .txt</button>
      <button id="btnCopy">Copiar</button>
    </div>

    <div class="row">
      <div>
        <label class="small">Resultado</label>
        <textarea id="outputPrompt" readonly placeholder="Aquí aparecerá el prompt mejorado..."></textarea>
      </div>
      <div>
        <label class="small">Historial (local)</label>
        <ul id="history"></ul>
      </div>
    </div>

    <footer>
      <div>
        <strong>Prompt Enhancer</strong> — local, gratis.
      </div>
      <div>
        <a href="#" class="link" id="resetConsent">Gestión cookies</a>
      </div>
    </footer>
  </div>

  <!-- Banner de cookies / consentimiento para analytics (si estás en la UE tienes obligación) -->
  <div id="cookieBanner" style="display:none" role="dialog" aria-live="polite">
    <p>Usamos analítica (Google Analytics) para estadísticas. ¿Permites cargar analytics y almacenar datos mínimos (IP anon.)?</p>
    <div class="cb-actions">
      <button id="btnAcceptCookies" class="primary">Aceptar</button>
      <button id="btnDeclineCookies">Rechazar</button>
    </div>
  </div>

<script>
// -------------------- Motor del enhancer (100% local) --------------------
(function(){
  // UTILIDADES
  function sanitize(s){ return (s||'').trim().replace(/\\s+/g,' '); }
  function randomOf(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

  // Pequeños diccionarios y plantillas para enriquecer prompts
  const roles = [
    "Actúa como un experto en prompting y redacción.",
    "Actúa como un editor profesional especializado en prompts para modelos de lenguaje.",
    "Actúa como un asistente creativo y técnico, optimizador de instrucciones para IA."
  ];

  const tones = {
    normal: "",
    creativo: "Usa un tono creativo, vívido y evocador.",
    tecnico: "Usa lenguaje técnico y pasos claros, enfocado en precisión."
  };

  const outputStyles = [
    "un prompt estructurado con secciones: contexto, objetivo, restricciones y formato de salida.",
    "un prompt conciso y directo, optimizado para respuestas breves y precisas.",
    "un prompt extendido con detalles sensoriales y ejemplos de salida."
  ];

  function buildEnhancer(input, opts){
    input = sanitize(input);
    if(!input) return "";

    opts = opts || {};
    const role = opts.role || randomOf(roles);
    const toneLabel = opts.tone || 'normal';
    const tone = tones[toneLabel] || "";
    const outStyle = opts.outStyle || randomOf(outputStyles);

    // reglas simples que mejoran estructura
    // 1) fuerza idioma y formato
    const langHint = /[¿¡]/.test(input) || /\\b(el|la|los|las)\\b/i.test(input) ? "Mantén el idioma en español." : "";

    // 2) si el prompt es muy corto, genera más contexto
    const needsContext = input.split(" ").length < 6;

    const contextAdd = needsContext ? "Añade contexto mínimo: quién es el interlocutor, qué tono se espera y para qué se usará la respuesta." : "";

    // 3) salida con instrucciones claras
    const final = [
      role,
      "Reescribe y optimiza el siguiente prompt para maximizar claridad, detalle y control del modelo.",
      "Objetivos:",
      "- Añadir contexto sin cambiar la intención original.",
      "- Eliminar ambigüedades y especificar el formato de salida.",
      "- Incluir restricciones cuando proceda (longitud, estilo, puntos a evitar).",
      "- Proveer ejemplos de output cuando sea útil.",
      "",
      "Formato de salida preferido: " + outStyle,
      tone ? ("Estilo requerido: " + tone) : "",
      langHint,
      contextAdd ? ("Nota adicional: " + contextAdd) : "",
      "",
      "Prompt original: \"" + input + "\"",
      "",
      "Devuelve solo el prompt final optimizado, sin explicaciones."
    ].filter(Boolean).join("\\n");

    return final;
  }

  // FUNCIONES DE INTERFAZ
  function saveToHistory(text){
    if(!text) return;
    const k = 'pe_history_v1';
    const h = JSON.parse(localStorage.getItem(k) || "[]");
    h.unshift({t: Date.now(), v: text});
    localStorage.setItem(k, JSON.stringify(h.slice(0,50)));
    renderHistory();
  }

  function renderHistory(){
    const k = 'pe_history_v1';
    const h = JSON.parse(localStorage.getItem(k) || "[]");
    const list = document.getElementById('history');
    list.innerHTML = '';
    h.forEach(item =>{
      const li=document.createElement('li');
      li.textContent = item.v.length>120 ? item.v.substring(0,120)+"…" : item.v;
      li.title = item.v;
      list.appendChild(li);
      li.addEventListener('click', ()=>{ document.getElementById('outputPrompt').value = item.v; });
    });
  }

  // Eventos botones
  document.getElementById('btnEnhance').addEventListener('click', ()=>{
    const inpt = document.getElementById('inputPrompt').value;
    const out = buildEnhancer(inpt, {});
    if(!out) return;
    document.getElementById('outputPrompt').value = out;
    saveToHistory(out);
  });

  document.getElementById('btnEnhance3').addEventListener('click', ()=>{
    const inpt = document.getElementById('inputPrompt').value;
    if(!sanitize(inpt)) return;
    const variants = [];
    for(let i=0;i<3;i++){ variants.push(buildEnhancer(inpt, {})); }
    document.getElementById('outputPrompt').value = variants.join("\\n\\n--- VARIACIÓN ---\\n\\n");
    saveToHistory(variants[0]);
  });

  document.getElementById('btnClear').addEventListener('click', ()=>{
    document.getElementById('inputPrompt').value = '';
    document.getElementById('outputPrompt').value = '';
  });

  document.getElementById('btnCopy').addEventListener('click', ()=>{
    const t=document.getElementById('outputPrompt').value;
    navigator.clipboard.writeText(t);
  });

  document.getElementById('btnExport').addEventListener('click', ()=>{
    const text = document.getElementById('outputPrompt').value || '';
    const blob = new Blob([text], {type:'text/plain'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'prompt_mejorado.txt';
    a.click();
    URL.revokeObjectURL(url);
  });

  // inicializar historial
  renderHistory();

  // quick UX: pegar contenido si el usuario tiene algo en el portapapeles (opcional)
  // Si quieres activar, descomenta la siguiente línea para intentar pegar al cargar
  // navigator.clipboard.readText().then(t=>{ if(t && t.length<1200) document.getElementById('inputPrompt').value = t }).catch(()=>{});

})();

// -------------------- Google Analytics (GDPR-friendly loader) --------------------
(function(){
  // CONFIG: pon aquí tu Measurement ID (ej: G-XXXXXXX)
  // Si dejas vacío, no se cargará analytics.
  const GA_MEASUREMENT_ID = ""; // <<< REEMPLAZA AQUÍ con tu ID, p.e. "G-ABCDEFG123"

  function loadGA(id){
    if(!id) return;
    // insertar gtag.js dinámicamente
    const s = document.createElement('script');
    s.async = true;
    s.src = 'https://www.googletagmanager.com/gtag/js?id=' + id;
    document.head.appendChild(s);

    window.dataLayer = window.dataLayer || [];
    function gtag(){window.dataLayer.push(arguments);}
    window.gtag = gtag;
    gtag('js', new Date());
    // activar anonymize_ip para más privacidad
    gtag('config', id, { 'anonymize_ip': true });
  }

  // Banner y consentimiento
  const banner = document.getElementById('cookieBanner');
  const accepted = localStorage.getItem('pe_ga_consent'); // 'granted' or 'denied' or null

  function showBanner(){ banner.style.display = 'flex'; }
  function hideBanner(){ banner.style.display = 'none'; }

  document.getElementById('btnAcceptCookies').addEventListener('click', ()=>{
    localStorage.setItem('pe_ga_consent','granted');
    hideBanner();
    if(GA_MEASUREMENT_ID) loadGA(GA_MEASUREMENT_ID);
  });

  document.getElementById('btnDeclineCookies').addEventListener('click', ()=>{
    localStorage.setItem('pe_ga_consent','denied');
    hideBanner();
  });

  // gestión por enlace en footer
  document.getElementById('resetConsent').addEventListener('click', (e)=>{
    e.preventDefault();
    localStorage.removeItem('pe_ga_consent');
    // si quieres forzar la recarga del banner:
    setTimeout(()=>{ checkConsent(); }, 100);
  });

  function checkConsent(){
    const s = localStorage.getItem('pe_ga_consent');
    if(!s){
      showBanner();
    } else if(s === 'granted'){
      // cargar analytics si el ID está puesto
      if(GA_MEASUREMENT_ID) loadGA(GA_MEASUREMENT_ID);
    } else {
      // denied -> no hacer nada
    }
  }

  // En la UE y España legalmente deberías pedir consentimiento antes de cargar analytics (según interpretación de la normativa)
  // Por eso por defecto no cargamos nada hasta que el usuario acepte.
  checkConsent();

})();
</script>

<!--
INSTRUCCIONES RÁPIDAS:
1) Para activar Google Analytics: reemplaza la cadena vacía en GA_MEASUREMENT_ID en el script por tu ID real (ej: "G-XXXXXXXXXX").
2) Si no quieres el banner de consentimiento y estás fuera de la UE, puedes mover la carga de loadGA() fuera del consentimiento y llamarla directamente con tu ID.
3) Para subir a GitHub Pages: crea repo, sube este archivo como index.html, activa Pages en Settings -> branch main -> /root.
-->

</body>
</html>
